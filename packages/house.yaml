automation:
  - id: 'ca4989f4-23c1-48d6-8178-fbad657a07b0'
    alias: "It's time to get ready for school"
    description: ""
    trigger:
      - platform: time
        at: "05:45:00"
    condition:
      - condition: time
        weekday:
          - mon
          - tue
          - wed
          - thu
          - fri
    action:
      - service: light.turn_on
        data:
          brightness_pct: 100
        target:
          area_id:
            - dining_room
            - family_room
            - foyer
            - kitchen
      - service: light.turn_on
        data:
          brightness_pct: 40
        target:
          area_id: bathroom
    mode: single

  - id: '3f4c0fdf-d9ef-468e-a973-8e7fa82c7483'
    alias: "Turn on the House at Sunset"
    mode: single
    description: "Lights will turn on 45 minutes before sunset"
    trigger:
      - platform: sun
        event: sunset
        offset: "-00:45"
    condition: []
    action:
      - service: light.turn_on
        data:
          transition: 10
          kelvin: 2700
          brightness_pct: 100
        target:
          area_id:
            - camdyn_s_room
            - den
            - dining_room
            - driveway
            - family_room
            - family_room_ambient
            - foyer
            - front_porch
            - hallway
            - kitchen
            - living_room
            - master_bedroom
            - molly_s_room
            - patio
      - service: light.turn_on
        data:
          transition: 10
          kelvin: 2700
          brightness_pct: 70
        target:
          area_id:
            - back_yard
            # - front_yard
            # - garden
            - side_yard

  - id: 'a85932d9-ff4e-486b-a3a1-89b07e84feef'
    alias: "It's time to Relax"
    description: "The relax scene is activated"
    mode: single
    trigger:
      - platform: time
        at: "20:15:00"
    condition: []
    action:
      - service: light.turn_on
        metadata: {}
        target:
          area_id:
            - camdyn_s_room
            - den
            - dining_room
            - family_room
            - family_room_ambient
            - foyer
            - hallway
            - kitchen
            - living_room
            - master_bedroom
            - molly_s_room
            - patio
        data:
          transition: 5
          kelvin: 2237
          brightness_pct: 60

  - id: '92c8fbbb-3b63-4408-95db-82587a3e704b'
    alias: "Turn off the House"
    description: ""
    trigger:
      - platform: device
        type: turned_on
        device_id: 27e9816fa86b7c98dd9c642d9353fbc3
        entity_id: switch.trigger
        domain: switch
    condition:
      - condition: sun
        after: sunset
        enabled: true
    action:
      - service: light.turn_off
        target:
          area_id:
            - back_yard
            - basement
            - bathroom
            - camdyn_s_room
            - den
            - dining_room
            - family_room
            - family_room_ambient
            - family_room_holiday
            - foyer
            - front_yard
            - front_yard_holiday
            - garden
            - hallway
            - living_room
            - kitchen
            - master_bedroom
            - master_closet
            - molly_s_room
            - office
            - patio
            - side_yard
            - workshop
        data: {}
      - service: switch.turn_off
        target:
          area_id:
            - bathroom
            - camdyn_s_room
            - family_room_ambient
            - family_room_holiday
            - front_yard
            - front_yard_holiday
            - hallway
            - living_room
            - master_bathroom
            - molly_s_room
            - office
            - workshop
          entity_id:
            - switch.outside_holiday_switches
            - switch.holiday_lights
        data: {}
      - service: light.turn_on
        target:
          entity_id:
            - light.barn_door_light
        data:
          transition: 5
          kelvin: 2237
          brightness_pct: 50
        metadata: {}
      - service: fan.turn_on
        data:
          percentage: 33
        target:
          entity_id: fan.master_bedroom_tower_fan
      - service: scene.turn_on
        target:
          entity_id: scene.turn_on_diffuser
        metadata: {}
    mode: single

  - id: '9b6de636-370c-4e4f-9059-23a03de6b41c'
    alias: 'Water Leak Notification'
    description: 'Send a notifcation to the Family if water is detected in any area'
    mode: single
    trigger:
      - platform: state
        entity_id:
          - binary_sensor.basement_water_leak_sensor_water_leak
        to: "on"
        id: basement_water_leak_sensor_wet
      - platform: state
        entity_id:
          - binary_sensor.kitchen_sink_water_leak_sensor_water_leak
        to: "on"
        id: kitchen_sink_water_leak_sensor_wet
      - platform: state
        entity_id:
          - binary_sensor.bathroom_sink_water_leak_sensor_water_leak
        to: "on"
        id: bathroom_sink_water_leak_sensor_wet
      - platform: state
        entity_id:
          - binary_sensor.bathroom_toilet_water_leak_sensor_water_leak
        to: "on"
        id: bathroom_toilet_water_leak_sensor_wet
      - platform: state
        entity_id:
          - binary_sensor.master_bathroom_sink_water_leak_sensor_water_leak
        to: "on"
        id: master_bathroom_sink_water_leak_sensor_wet
      - platform: state
        entity_id:
          - binary_sensor.master_bathroom_toilet_water_leak_sensor_water_leak
        to: "on"
        id: master_bathroom_toilet_water_leak_sensor_wet
    condition: []
    action:
      - choose:
          - conditions:
              - condition: trigger
                id:
                  - basement_water_leak_sensor_wet
                  - kitchen_sink_water_leak_sensor_wet
                  - bathroom_sink_water_leak_sensor_wet
                  - bathroom_toilet_water_leak_sensor_wet
                  - master_bathroom_sink_water_leak_sensor_wet
                  - master_bathroom_toilet_water_leak_sensor_wet
            sequence:
              - service: notify.family_devices
                data:
                  message: clear_notification
                  data:
                    tag: water-leak-detected
              - service: notify.family_devices
                metadata: {}
                data:
                  title: Water Leak Detected!
                  message: >-
                    {{ trigger.to_state.attributes.friendly_name }} has detected a
                    water leak!
                  tag: water-leak-detected
